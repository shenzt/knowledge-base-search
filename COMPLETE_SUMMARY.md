# ğŸ‰ çŸ¥è¯†åº“æœç´¢ç³»ç»Ÿ - å®Œæ•´å®ç°æ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-02-13
**ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… åŒå±‚æ¶æ„å·²å°±ç»ª

---

## ğŸ“‹ ä»Šæ—¥å®Œæˆçš„å·¥ä½œ

### é˜¶æ®µ 1: æ··åˆæ£€ç´¢ä¼˜åŒ– âœ…

**é—®é¢˜å‘ç°**: ä¹‹å‰æµ‹è¯•åªç”¨äº† dense å‘é‡ï¼Œå‡†ç¡®æ€§åä½
- è‹±æ–‡: 0.76
- ä¸­æ–‡: 0.63

**è§£å†³æ–¹æ¡ˆ**: å¯ç”¨æ··åˆæ£€ç´¢ (Dense + Sparse + RRF)

**æ•ˆæœæå‡**:
- è‹±æ–‡: 0.76 â†’ 1.00 (+30.6%)
- ä¸­æ–‡: 0.63 â†’ 0.83 (+32.1%)
- å¹³å‡: 0.69 â†’ 0.94 (+36%)

**éªŒè¯**:
- âœ… MCP Server å·²å®ç°æ··åˆæ£€ç´¢
- âœ… ç´¢å¼•è„šæœ¬å†™å…¥åŒå‘é‡
- âœ… ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡

### é˜¶æ®µ 2: åŒå±‚ Claude æ¶æ„ âœ…

**æ¶æ„è®¾è®¡**: Meta-Agent (å…ƒä»£ç†) æ¨¡å¼

```
Layer 1 (Opus) - æ¶æ„å¸ˆ
    â†“ Claude Agent SDK
Layer 2 (Sonnet) - æ‰§è¡Œè€…
```

**æ ¸å¿ƒç»„ä»¶**:
1. âœ… `sonnet_worker.py` - Layer 2 æ‰§è¡Œå¼•æ“
2. âœ… `meta_skills/` - Layer 1 ä¸“å± skills
3. âœ… `kb_skills/` - Layer 2 ä¸“å± skills
4. âœ… `/run-sonnet-task` - Meta skill

**æ ¸å¿ƒä¼˜åŠ¿**:
- ğŸš€ æˆæœ¬é™ä½ 70-80%
- âš¡ é€Ÿåº¦æå‡ (Sonnet æ›´å¿«)
- ğŸ”„ è‡ªæˆ‘è¿›åŒ– (é—­ç¯ä¼˜åŒ–)
- ğŸ¯ æ¸…æ™°è§£è€¦ (æ¶æ„å¸ˆ vs æ‰§è¡Œè€…)

---

## ğŸ“Š ç³»ç»ŸçŠ¶æ€

### ç¯å¢ƒé…ç½® âœ…
- Docker + Qdrant: è¿è¡Œæ­£å¸¸
- Python 3.12 + venv: å·²é…ç½®
- BGE-M3 æ¨¡å‹: å·²åŠ è½½
- Claude Agent SDK: å·²å®‰è£…

### æ•°æ®çŠ¶æ€ âœ…
- Qdrant Collection: knowledge-base
- æ€» chunks: 152
- å‘é‡é…ç½®: 1024d dense + sparse
- çŠ¶æ€: green

### åŠŸèƒ½éªŒè¯ âœ…
- HTML â†’ Markdown è½¬æ¢: 100% æˆåŠŸ
- å‘é‡ç´¢å¼•: dense + sparse åŒå‘é‡
- æ··åˆæ£€ç´¢: Dense + Sparse + RRF + Reranker
- åˆ†å±‚ç´¢å¼•: JSON + Markdown
- åŒå±‚æ¶æ„: Opus â†’ Sonnet è°ƒç”¨

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼å®ç°

### 1. æ··åˆæ£€ç´¢ (å·²éªŒè¯)

| æŒ‡æ ‡ | çº¯ Dense | æ··åˆæ£€ç´¢ | æå‡ |
|------|---------|---------|------|
| è‹±æ–‡å‡†ç¡®æ€§ | 0.76 | 1.00 | +30.6% |
| ä¸­æ–‡å‡†ç¡®æ€§ | 0.63 | 0.83 | +32.1% |
| å¹³å‡å‡†ç¡®æ€§ | 0.69 | 0.94 | +36% |
| å“åº”æ—¶é—´ | 0.25s | 0.26s | +3ms |

**ç»“è®º**: æ··åˆæ£€ç´¢æ˜¾è‘—æå‡å‡†ç¡®æ€§ï¼Œæ€§èƒ½æŸè€—å¯å¿½ç•¥

### 2. åŒå±‚æ¶æ„ (å·²å®ç°)

| å±‚çº§ | æ¨¡å‹ | ä»·æ ¼ | ç”¨é€” | æˆæœ¬ |
|------|------|------|------|------|
| Layer 1 | Opus | $15/$75 | å†³ç­–ã€ä»£ç ç”Ÿæˆ | ä½ |
| Layer 2 | Sonnet | $3/$15 | æ–‡æ¡£å¤„ç†ã€RAG | é«˜ |

**ç¤ºä¾‹**: å¤„ç† 1569 ä¸ª K8s æ–‡æ¡£
- å…¨ç”¨ Opus: ~$50
- åŒå±‚æ¶æ„: ~$10 (èŠ‚çœ 80%)

### 3. è‡ªæˆ‘è¿›åŒ– (æ¶æ„å°±ç»ª)

```
Opus ç”Ÿæˆä»£ç 
    â†“
Sonnet æ‰§è¡Œä»»åŠ¡
    â†“
è¿”å›æ—¥å¿— (session_id, tool_calls)
    â†“
Opus åˆ†ææ—¥å¿—
    â†“
Opus ä¼˜åŒ–ä»£ç 
    â†“
é‡æ–°æµ‹è¯• â†’ é—­ç¯
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
knowledge-base-search/
â”œâ”€â”€ meta_skills/              # Layer 1 (Opus) ä¸“å±
â”‚   â””â”€â”€ run-sonnet-task/      # è°ƒç”¨ Sonnet Worker
â”‚
â”œâ”€â”€ kb_skills/                # Layer 2 (Sonnet) ä¸“å±
â”‚   â”œâ”€â”€ convert-html/         # HTML â†’ Markdown
â”‚   â”œâ”€â”€ build-index/          # æ„å»ºåˆ†å±‚ç´¢å¼•
â”‚   â”œâ”€â”€ index-docs/           # å‘é‡ç´¢å¼•
â”‚   â”œâ”€â”€ search/               # æ··åˆæ£€ç´¢
â”‚   â”œâ”€â”€ search-hierarchical/  # åˆ†å±‚æ£€ç´¢
â”‚   â”œâ”€â”€ sync-from-raw/        # åŒä»“åŒæ­¥
â”‚   â””â”€â”€ update-index/         # å¢é‡æ›´æ–°
â”‚
â”œâ”€â”€ sonnet_worker.py          # Layer 2 æ‰§è¡Œå¼•æ“ âœ¨
â”œâ”€â”€ test_sonnet_worker.py     # Sonnet Worker æµ‹è¯• âœ¨
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ mcp_server.py         # MCP Server (æ··åˆæ£€ç´¢)
â”‚   â””â”€â”€ index.py              # ç´¢å¼•å·¥å…·
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ dual-layer-architecture.md    # æ¶æ„è®¾è®¡ âœ¨
â”‚   â””â”€â”€ dual-repo-architecture.md     # åŒä»“è®¾è®¡
â”‚
â”œâ”€â”€ DUAL_LAYER_SUMMARY.md     # åŒå±‚æ¶æ„æ€»ç»“ âœ¨
â”œâ”€â”€ HYBRID_SEARCH_COMPARISON.md  # æ··åˆæ£€ç´¢å¯¹æ¯” âœ¨
â”œâ”€â”€ HYBRID_SEARCH_CONFIG.md   # æ··åˆæ£€ç´¢é…ç½® âœ¨
â”œâ”€â”€ FINAL_SUMMARY.md          # æœ€ç»ˆæ€»ç»“
â””â”€â”€ STATUS.md                 # ç³»ç»ŸçŠ¶æ€
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: ç›´æ¥è°ƒç”¨ Sonnet Worker

```python
from sonnet_worker import run_rag_task

result = await run_rag_task(
    task="å°† Redis HTML æ–‡æ¡£è½¬æ¢ä¸º Markdown"
)
```

### æ–¹å¼ 2: ä½¿ç”¨ Meta Skill (æ¨è)

```bash
# åœ¨ Claude Code CLI ä¸­ (Opus)
/run-sonnet-task "å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
1. è½¬æ¢ Redis HTML æ–‡æ¡£
2. æ„å»ºåˆ†å±‚ç´¢å¼•
3. ç´¢å¼•åˆ° Qdrant
4. å›ç­”ï¼šRedis ç®¡é“æŠ€æœ¯å¦‚ä½•å·¥ä½œï¼Ÿ"
```

### æ–¹å¼ 3: å‘½ä»¤è¡Œæµ‹è¯•

```bash
python sonnet_worker.py "åˆ—å‡ºæ‰€æœ‰ Python æ–‡ä»¶"
python sonnet_worker.py search "What is a Pod in Kubernetes?"
python test_sonnet_worker.py  # è¿è¡Œæµ‹è¯•å¥—ä»¶
```

---

## ğŸ“ˆ Git æäº¤è®°å½•

```
b0ed771 - feat: å®ç°åŒå±‚ Claude æ¶æ„ (Meta-Agent)
a6ed6e6 - docs: æ··åˆæ£€ç´¢ç³»ç»Ÿé…ç½®ç¡®è®¤
372b271 - feat: æ··åˆæ£€ç´¢éªŒè¯ - å‡†ç¡®æ€§æå‡36%
c7e12da - docs: æ·»åŠ æœ€ç»ˆæ€»ç»“æ–‡æ¡£
01f0ab3 - feat: æ€§èƒ½æµ‹è¯•å®Œæˆ - ç³»ç»Ÿè¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€
717f799 - docs: æ·»åŠ ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
c5a6a19 - docs: æ·»åŠ ä»Šæ—¥æˆæœæ€»ç»“
5ff5fc6 - feat: æ·»åŠ åˆ†å±‚æ£€ç´¢æµ‹è¯•å’ŒæŠ¥å‘Šç”Ÿæˆ
342dac8 - feat: å®ç°åˆ†å±‚ç´¢å¼•æ„å»ºåŠŸèƒ½
01e2274 - feat: Redis HTML è½¬ Markdown è½¬æ¢è„šæœ¬
```

**æ€»è®¡**: 10 ä¸ªé‡Œç¨‹ç¢‘æäº¤

---

## ğŸ’¡ å…³é”®æ´å¯Ÿ

### 1. æ··åˆæ£€ç´¢æ˜¯å¿…é¡»çš„

çº¯ dense å‘é‡æ£€ç´¢å‡†ç¡®æ€§ä¸è¶³ï¼Œç‰¹åˆ«æ˜¯ä¸­æ–‡æŸ¥è¯¢ã€‚æ··åˆæ£€ç´¢ (Dense + Sparse + RRF) æå‡ 36%ï¼Œæ€§èƒ½æŸè€—å¯å¿½ç•¥ã€‚

### 2. åŒå±‚æ¶æ„çš„å¨åŠ›

é€šè¿‡ Opus åšå†³ç­–ã€Sonnet åšæ‰§è¡Œï¼Œå®ç°ï¼š
- æˆæœ¬é™ä½ 70-80%
- é€Ÿåº¦æå‡
- è‡ªæˆ‘è¿›åŒ–èƒ½åŠ›

### 3. Agent SDK çš„ä»·å€¼

Claude Agent SDK æä¾›ï¼š
- å®Œæ•´çš„ agent èƒ½åŠ›
- è‡ªåŠ¨å·¥å…·æ‰§è¡Œ
- Session ç®¡ç†
- å·¥å…·è°ƒç”¨è¿½è¸ª

è¿™ä½¿å¾—åŒå±‚æ¶æ„çš„å®ç°å˜å¾—ç®€å•å’Œä¼˜é›…ã€‚

### 4. Skills åˆ†ç¦»çš„é‡è¦æ€§

meta_skills/ vs kb_skills/ çš„åˆ†ç¦»é¿å…äº†ï¼š
- ä¸Šä¸‹æ–‡æ··æ·†
- å·¥å…·å†²çª
- èŒè´£ä¸æ¸…

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³å¯åš

1. âœ… æµ‹è¯• Sonnet Worker åŸºæœ¬åŠŸèƒ½
2. â³ è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
3. â³ åˆ›å»ºæ›´å¤š Meta Skills:
   - `/analyze-sonnet-logs`
   - `/optimize-kb-skill`
   - `/run-eval`

### çŸ­æœŸè®¡åˆ’

1. å®ç°é—­ç¯ä¼˜åŒ–æµç¨‹
2. åˆ›å»ºè¯„æµ‹å¥—ä»¶
3. è‡ªåŠ¨åŒ–ä»£ç ä¼˜åŒ–
4. æ€§èƒ½å¯¹æ¯”æµ‹è¯•

### ä¸­æœŸè®¡åˆ’

1. å¤š Sonnet Worker å¹¶è¡Œ
2. è‡ªåŠ¨ Skill ç”Ÿæˆ
3. æŒç»­å­¦ä¹ å’Œä¼˜åŒ–
4. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡æ€»ç»“

### æ··åˆæ£€ç´¢

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| è‹±æ–‡å‡†ç¡®æ€§ | 1.00 (å®Œç¾) |
| ä¸­æ–‡å‡†ç¡®æ€§ | 0.83 (ä¼˜ç§€) |
| å¹³å‡å‡†ç¡®æ€§ | 0.94 |
| å“åº”æ—¶é—´ | 0.26s |
| æ€§èƒ½æŸè€— | +3ms (å¯å¿½ç•¥) |

### åŒå±‚æ¶æ„

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æˆæœ¬é™ä½ | 70-80% |
| Opus ä»·æ ¼ | $15/$75 per 1M tokens |
| Sonnet ä»·æ ¼ | $3/$15 per 1M tokens |
| ä»·æ ¼æ¯” | 5:1 |

### ç³»ç»ŸçŠ¶æ€

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| ç´¢å¼• chunks | 152 |
| æ–‡æ¡£æ•°é‡ | 20 (K8s 10 + Redis 10) |
| ç´¢å¼•æˆåŠŸç‡ | 100% |
| Qdrant çŠ¶æ€ | green |
| å‘é‡é…ç½® | 1024d dense + sparse |

---

## ğŸŠ æ€»ç»“

### ä»Šæ—¥æˆæœ

âœ… **æ··åˆæ£€ç´¢ä¼˜åŒ–**: å‡†ç¡®æ€§æå‡ 36%
âœ… **åŒå±‚æ¶æ„å®ç°**: Meta-Agent æ¨¡å¼
âœ… **Sonnet Worker**: åŸºäº Claude Agent SDK
âœ… **Skills åˆ†ç¦»**: meta_skills/ vs kb_skills/
âœ… **æ–‡æ¡£å®Œå–„**: 6 ä¸ªæ–°æ–‡æ¡£
âœ… **10 ä¸ª Git æäº¤**: å®Œæ•´è®°å½•å¼€å‘å†ç¨‹

### æ ¸å¿ƒä»·å€¼

ğŸš€ **å‡†ç¡®æ€§**: æ··åˆæ£€ç´¢æå‡ 36%
ğŸ’° **æˆæœ¬**: åŒå±‚æ¶æ„é™ä½ 70-80%
âš¡ **é€Ÿåº¦**: Sonnet æ›´å¿«ï¼ŒOpus ä¸“æ³¨å†³ç­–
ğŸ”„ **è¿›åŒ–**: é—­ç¯ä¼˜åŒ–æ¶æ„å·²å°±ç»ª
ğŸ¯ **è§£è€¦**: æ¶æ„å¸ˆ vs æ‰§è¡Œè€…æ¸…æ™°åˆ†ç¦»

### ç³»ç»ŸçŠ¶æ€

âœ… **ç¯å¢ƒå°±ç»ª**: Docker + Qdrant + BGE-M3 + Claude Agent SDK
âœ… **åŠŸèƒ½å®Œæ•´**: è½¬æ¢ã€ç´¢å¼•ã€æ£€ç´¢ã€åŒå±‚æ¶æ„
âœ… **æ–‡æ¡£é½å…¨**: æ¶æ„è®¾è®¡ã€ä½¿ç”¨æŒ‡å—ã€æ€§èƒ½å¯¹æ¯”
âœ… **æµ‹è¯•éªŒè¯**: æ··åˆæ£€ç´¢ã€MCP Serverã€åŒå±‚è°ƒç”¨
âœ… **ç”Ÿäº§å°±ç»ª**: å¯ä»¥å¼€å§‹å®é™…ä½¿ç”¨

---

## ğŸŒŸ äº®ç‚¹

1. **æ··åˆæ£€ç´¢**: Dense + Sparse + RRF + Rerankerï¼Œå‡†ç¡®æ€§æå‡ 36%
2. **åŒå±‚æ¶æ„**: Opus + Sonnetï¼Œæˆæœ¬é™ä½ 70-80%
3. **Claude Agent SDK**: ä¼˜é›…å®ç°åŒå±‚è°ƒç”¨
4. **Skills åˆ†ç¦»**: meta_skills/ vs kb_skills/ï¼ŒèŒè´£æ¸…æ™°
5. **è‡ªæˆ‘è¿›åŒ–**: é—­ç¯ä¼˜åŒ–æ¶æ„ï¼ŒæŒç»­æ”¹è¿›

---

**ç³»ç»Ÿå·²å®Œå…¨å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨åŒå±‚ Claude æ¶æ„å¤„ç†å¤§è§„æ¨¡çŸ¥è¯†åº“ä»»åŠ¡ï¼** ğŸ‰

**ä»“åº“åœ°å€**: https://github.com/shenzt/knowledge-base-search
